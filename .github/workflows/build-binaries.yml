name: Build snapcast

on:
  pull_request:

jobs:
  build:
    strategy:
        matrix:
          config: ['hifi-esparagus', 'loud-esparagus', 'louder-esparagus']

    runs-on: ubuntu-latest
    container:
        image: espressif/idf:v5.1.1
        # volumes:
        #   - ${{ github.workspace }}:/project
        #   - /dev:/dev
        # options: --workdir /project
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        submodules: 'true'

    - run: cp sdkconfig.${{ matrix.config }} sdkconfig
    - run: . $IDF_PATH/export.sh && idf.py build
    - run: ls -al build 
    - run: cp build/snapclient.bin ./docs/artifacts/${{ matrix.config }}-snapclient-latest-snapclient.bin
    - run: cp build/storage.bin ./docs/artifacts/${{ matrix.config }}-snapclient-latest-storage.bin
    - run: cp build/ota_data_initial.bin ./docs/artifacts/${{ matrix.config }}-snapclient-latest-ota_data_initial.bin
    - run: cp build/bootloader/bootloader.bin ./docs/artifacts/${{ matrix.config }}-snapclient-latest-bootloader.bin
    - run: cp build/partition_table/partition-table.bin ./docs/artifacts/${{ matrix.config }}-snapclient-latest-partition-table.bin
    - run: git status
    
    